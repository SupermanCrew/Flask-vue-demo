import{s as R}from"./s-drawer.e3a36ec6.js";import{_ as U,r as i,o as d,c as u,a as t,w as l,i as w,F as h,f as m,b as z,e as C,g as k}from"./index.5c1af3c9.js";const q={components:{sDrawer:R},watch:{visible(e){e||(this.form={})}},data(){return{form:{},xydata:[],value1:[],value2:[],visible:!1,tableData:[],totalNum:100,search:{pageNum:1,pageSize:10}}},created(){this.getList(),this.getcbs(),this.getzz(),this.isAdmin=localStorage.getItem("isAdmin"),this.mj_id=localStorage.getItem("userInfoid"),this.isAdmin==2&&(this.form.maijia_id=this.mj_id)},methods:{async getList(){const e=await this.$request.get("/ts/",{params:this.search});e.data.code===200&&(console.log(e.data,"1111111111111111111111"),this.tableData=e.data.data,this.totalNum=e.data.zs)},async getcbs(){const e=await this.$request.get("/cbs/",{params:this.search});e.data.code===200&&(console.log(e.data),this.cbsdata=e.data.data)},async getzz(){const e=await this.$request.get("/zz/",{params:this.search});e.data.code===200&&(console.log(e.data),this.zzdata=e.data.data)},handleSizeChange(e){console.log(`\u6BCF\u9875 ${e} \u6761`),this.search.pageSize=e,this.getList()},handleCurrentChange(e){console.log(`\u5F53\u524D\u9875: ${e}`),this.search.pageNum=e,this.getList()},resetSearch(){let e={pageNum:this.search.pageNum,pageSize:this.search.pageSize};this.search=e,this.getList()},editItem(e){this.form=this.$deepClone(e),this.visible=!0},async saveData(){if(this.form.id){const e=await this.$request.put("/ts/"+this.form.id+"/",this.form);e.data.code===200&&(this.$message.success(e.data.message),this.getList(),this.visible=!1)}else{const e=await this.$request.post("/ts/",this.form);e.data.code===200&&(console.log(e.data,"dddddddddddddddd"),this.$message.success(e.data.message),this.getList(),this.visible=!1)}},async deleteItem(e){const a=await this.$request.delete("/ts/"+e+"/");a.data.code===200&&(this.$message.success(a.data.message),this.getList())},handleExceed(e,a){this.$notify.warning({title:"\u8B66\u544A",message:`\u53EA\u80FD\u9009\u62E9 ${this.limitNum} \u4E2A\u6587\u4EF6\uFF0C\u5F53\u524D\u5171\u9009\u62E9\u4E86 ${e.length+a.length} \u4E2A`})},handleBeforeUpload(e){e.size/1024/1024>1&&this.$notify.warning({title:"\u8B66\u544A",message:"\u56FE\u7247\u5927\u5C0F\u5FC5\u987B\u5C0F\u4E8E1M"})},handleSuccess1(e){console.log(e.data,"777777777777777777777777777777777777777"),this.form.img_url=e.data.file,this.dialogImageUrl="",this.$notify({title:"\u901A\u77E5",message:"\u4E0A\u4F20\u7167\u7247\u6210\u529F~",type:"success",duration:5e3})}}},F={key:0},A={style:{"text-align":"right"}},B=["src"],E={key:0},P={key:0},j={key:1};function M(e,a,T,G,s,n){const r=i("el-button"),_=i("el-input"),p=i("el-form-item"),V=i("el-col"),S=i("el-row"),f=i("el-form"),g=i("el-card"),c=i("el-table-column"),x=i("el-popconfirm"),N=i("el-table"),I=i("el-pagination"),b=i("el-upload"),v=i("el-option"),y=i("el-select"),L=i("sDrawer");return d(),u(h,null,[e.isAdmin!=3?(d(),u("div",F,[t(r,{type:"primary",onClick:a[0]||(a[0]=o=>s.visible=!0)},{default:l(()=>[m("\u6DFB\u52A0\u56FE\u4E66")]),_:1})])):w("",!0),t(g,{shadow:"never",style:{"margin-top":"10px"}},{default:l(()=>[t(g,{shadow:"never",style:{margin:"10px 0"}},{default:l(()=>[t(f,{model:s.search},{default:l(()=>[t(S,{gutter:30},{default:l(()=>[t(V,{xs:24,sm:12,md:8,lg:6},{default:l(()=>[t(p,{label:"\u56FE\u4E66\u540D:"},{default:l(()=>[t(_,{modelValue:s.search.title,"onUpdate:modelValue":a[1]||(a[1]=o=>s.search.title=o),placeholder:"\u8BF7\u8F93\u5165\u56FE\u4E66\u540D"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),z("div",A,[t(r,{type:"primary",onClick:a[2]||(a[2]=o=>n.getList())},{default:l(()=>[m("\u67E5\u8BE2")]),_:1}),t(r,{onClick:a[3]||(a[3]=o=>n.resetSearch())},{default:l(()=>[m("\u91CD\u7F6E")]),_:1})])]),_:1}),t(N,{data:s.tableData,stripe:""},{default:l(()=>[t(c,{prop:"id",label:"ID",width:"70"}),t(c,{prop:"title",label:"\u4E66\u7C4D\u540D\u79F0"}),t(c,{label:"\u56FE\u4E66\u56FE\u7247"},{default:l(o=>[z("img",{src:"http://127.0.0.1:5000/upimg/"+o.row.img_url,width:"100",height:"100"},null,8,B)]),_:1}),t(c,{prop:"publisher",label:"\u51FA\u7248\u793E"}),t(c,{prop:"authors",label:"\u4F5C\u8005"}),t(c,{label:"\u64CD\u4F5C",width:"120",fixed:"right"},{default:l(o=>[e.isAdmin==1?(d(),u("div",E,[t(r,{link:"",type:"primary",size:"small",onClick:D=>n.editItem(o.row)},{default:l(()=>[m("\u7F16\u8F91")]),_:2},1032,["onClick"]),t(x,{title:"\u786E\u5B9A\u8981\u5220\u9664\u5417?",onConfirm:D=>n.deleteItem(o.row.id)},{reference:l(()=>[t(r,{link:"",type:"primary",size:"small"},{default:l(()=>[m("\u5220\u9664")]),_:1})]),_:2},1032,["onConfirm"])])):w("",!0)]),_:1})]),_:1},8,["data"]),t(I,{background:"",onSizeChange:n.handleSizeChange,onCurrentChange:n.handleCurrentChange,layout:"sizes, total, prev, pager, next",total:s.totalNum,currentPage:s.search.pageNum,pageSize:s.search.pageSize},null,8,["onSizeChange","onCurrentChange","total","currentPage","pageSize"])]),_:1}),t(L,{modelValue:s.visible,"onUpdate:modelValue":a[9]||(a[9]=o=>s.visible=o),title:s.form.id?"\u7F16\u8F91\u5B66\u9662":"\u6DFB\u52A0\u5B66\u9662",size:"35%","close-on-click-modal":!1},{footer:l(()=>[t(r,{onClick:a[7]||(a[7]=o=>s.visible=!1)},{default:l(()=>[m("\u53D6\u6D88")]),_:1}),t(r,{type:"primary",onClick:a[8]||(a[8]=o=>n.saveData())},{default:l(()=>[m("\u786E\u5B9A")]),_:1})]),default:l(()=>[t(f,{model:s.form,"label-width":"80px",ref:"ruleFormRef"},{default:l(()=>[t(p,{label:"\u56FE\u4E66\u6807\u9898:"},{default:l(()=>[t(_,{modelValue:s.form.title,"onUpdate:modelValue":a[4]||(a[4]=o=>s.form.title=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),t(f,{model:s.form,"label-width":"80px",ref:"ruleFormRef"},{default:l(()=>[t(p,{label:"\u56FE\u4E66\u56FE\u7247:"},{default:l(()=>[s.form.id?(d(),u("div",P,[t(b,{class:"upload-demo",action:"http://127.0.0.1:5000/img_upload/",data:{data:s.form.id},"on-preview":e.handlePreview,"on-remove":e.handleRemove,"before-remove":e.beforeRemove,"on-success":n.handleSuccess1,multiple:"",limit:1,"on-exceed":n.handleExceed},{default:l(()=>[t(r,{type:"primary",size:"mini",icon:"el-icon-upload"},{default:l(()=>[m(" \u4FEE\u6539\u56FE\u7247 ")]),_:1})]),_:1},8,["data","on-preview","on-remove","before-remove","on-success","on-exceed"])])):(d(),u("div",j,[t(b,{class:"upload-demo",action:"http://127.0.0.1:5000/img_upload/","on-preview":e.handlePreview,"on-remove":e.handleRemove,"before-remove":e.beforeRemove,"on-success":n.handleSuccess1,multiple:"",limit:1,"on-exceed":n.handleExceed},{default:l(()=>[t(r,{type:"primary",size:"mini",icon:"el-icon-upload"},{default:l(()=>[m(" \u4E0A\u4F20\u56FE\u7247 ")]),_:1})]),_:1},8,["on-preview","on-remove","before-remove","on-success","on-exceed"])]))]),_:1})]),_:1},8,["model"]),t(f,{model:s.form,"label-width":"80px",ref:"ruleFormRef"},{default:l(()=>[t(p,{label:"\u51FA\u7248\u793E:"},{default:l(()=>[t(y,{modelValue:s.form.publishs_id,"onUpdate:modelValue":a[5]||(a[5]=o=>s.form.publishs_id=o),clearable:"",placeholder:"\u8BF7\u9009\u62E9"},{default:l(()=>[(d(!0),u(h,null,C(e.cbsdata,o=>(d(),k(v,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),t(f,{model:s.form,"label-width":"80px",ref:"ruleFormRef"},{default:l(()=>[t(p,{label:"\u4F5C\u8005:"},{default:l(()=>[t(y,{modelValue:s.form.authors_id,"onUpdate:modelValue":a[6]||(a[6]=o=>s.form.authors_id=o),multiple:"",placeholder:"\u8BF7\u9009\u62E9"},{default:l(()=>[(d(!0),u(h,null,C(e.zzdata,o=>(d(),k(v,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}const K=U(q,[["render",M],["__scopeId","data-v-3fee4cdb"]]);export{K as default};
